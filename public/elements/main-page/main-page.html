<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<!-- <link rel="import" href="../../bower_components/neon-animation/web-animations.html"> -->

<link rel="import" href="../../bower_components/shadycss/apply-shim.html">
<link rel="import" href="../shared-style/shared-style.html">

<link rel="import" href="../announcement-page/announcement-page.html">
<link rel="import" href="../profile-page/roomie-element.html">

<dom-module id="main-page">
  <template>
    <div id="main_container">
      <aside>
        <h2>Quick Filter</h2>
        <p>I am looking for:</p>
        <paper-button class="active" raised id="toggleRoomies" on-click="_setActive">Roomies</paper-button>
        <paper-button raised id="toggleAppartments" on-click="_setActive">Appartments</paper-button>

        <template is="dom-if" if="{{!toggle}}">
          <span>
            <p>Age</p>
            <paper-slider id="price" pin value="3" max="1000" editable></paper-slider>
          </span>


        </template>

        <template is="dom-if" if="{{toggle}}">
          <span><p>Price:</p>
            <paper-slider id="price" pin value="3" max="1000" editable></paper-slider>
          </span>
          <span>
            <p>City:</p>
            <paper-dropdown-menu id="city" label="Choose a city">
              <paper-listbox slot="dropdown-content">
                <paper-item>Bellinzona</paper-item>
                <paper-item>Locarno</paper-item>
                <paper-item>Lugano</paper-item>
              </paper-listbox>
            </paper-dropdown-menu>
          </span>
          <span>
            <p>Allows smokers:</p>
            <paper-toggle-button id="smokers"></paper-toggle-button>
          </span>
          <div>
            <p>Allows Pets:</p>
            <paper-toggle-button id="pets"></paper-toggle-button>
          </div>

        </template>
        <paper-button raised>Filter!</paper-button>
      </aside>
      <main>
        <template is="dom-if" if="{{!toggle}}">
          <template is="dom-repeat" items="{{people}}" as="person">
            <paper-card preloadImage="true" fadeImage="true"
            heading="{{person.name}}" image="{{person.picSrc}}" alt="pic">
              <div>
                {{person.desc}}
              </div>
              <div class="contact-buttons">
                  <roomie-element></roomie-element>
              </div>
            </paper-card>
          </template>
        </template>

        <template is="dom-if" if="{{toggle}}">
          <template is="dom-repeat" items="{{appartments}}" as="appartment">
            <paper-card preloadImage="true" fadeImage="true"
            heading="{{appartment.name}}" image="{{appartment.picSrc}}" alt="pic">
              <div>
                {{appartment.desc}}
              </div>
              <div class="contact-buttons">
                <announcement-page class$="{{appartment.id}}"
                 _id="{{appartment.id}}"></announcement-page>
              </div>
            </paper-card>
            <p>{{appartment.id}}</p>
          </template>
        </template>
     </main>
    </div>

    <style include="shared-style">
    .active {
      color : white;
      background-color: var(--shared-main-color);
    }
      #main_container {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: center;
        height: 100px;
      }
      aside {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        min-height: 100vh;
        height: 100%;
        text-align: center;
      }
      aside h2, p {
        text-align: center;
        font-family: var(--shared-text-font);
      }
      p {
        margin : 0;
        padding:0;
      }
      paper-toggle-button {
        /*display: block;
        max-width : 200px;
        margin: auto;*/
      }
      main {
        display : flex;
        flex: 3;
        flex-direction: row;
        flex-wrap : wrap;
        justify-content: space-evenly;
      }
      paper-button {
        font-family: var(--shared-button-font);
        padding: 2px;
        text-align: center;
      }
      aside paper-button{
        display: block;
        margin: 5px;
        font-size: 1.5em;

      }

      .toggle {
        width : 40%;
      }
      paper-card {
        font-family: var(--shared-serious-font);
        max-width: 400px;
        height : auto;
        margin-bottom: 5px;
        --paper-card-header-color : white;
      }
      paper-card:hover {
        background-color: #f2f2f2;
        cursor: pointer;
      }
      .contact-buttons {
        display: flex;
        justify-content: center;
        font-size: 1.2em;
        margin-bottom: 3px;
      }
      paper-search-bar {
       border-radius: 22px;
       padding: 0 8px;
       display: inline-block;
       width: 35%;
       margin : auto;
       background-color: white;
     }
    </style>
  </template>
  <script src="../../ajax/ajax.js"></script>
 <script src="../main.js"></script>
  <script>
  class MainPage extends Polymer.Element {
    constructor() {
      super();
      doJSONRequest("GET", "/location", {}, {}, function(data) {
        if(typeof data!=='undefined') {
          console.log("called jsonReq");
          this._deleteList(false);
          let popListFun = this._popList.bind(this);
          popListFun(data, false);
        }
      }.bind(this)
    );
    }

    static get is() {
      return 'main-page';
    }

    _deleteList(flag) {
      console.log(this);
      if(flag) {
        this.splice("people", 0, this.people.length);
      }else {
        this.splice("appartments", 0, this.appartments.length);
      }
    }

    _popList(data) {
      console.log(data);
      if(typeof data !== "undefined") {
        let address;
        let addFun = this._addAppartment.bind(this);
        data.forEach(function(e) {
          address = "" + e.city + e.street + e.buildingNumber;
          addFun(e._id, e.cap, address, e.description, [])
        });
      }
    }

    _setActive(e) {
      let el = e.path[0];
      if(el.className === "active") {
        return;
      }else {
        if(el.id === "toggleRoomies") {
          this.shadowRoot.querySelector("#toggleAppartments").className = "";
          this.toggle = false;
        }if(el.id === "toggleAppartments") {
          this.shadowRoot.querySelector("#toggleRoomies").className = "";
          this.toggle = true;
        }
      }
      el.className = "active";
    }

    _addAppartment(iden, picsrc, nam, description, tgs) {
      console.log("id is " + iden);
      this.push("appartments", {
        id : iden,
        picSrc : picsrc,
        name : nam,
        desc : description,
        tags : tgs
      });
    }

    _addPeople(iden, picsrc, nam, description, tgs) {
      this.push("people", {
        id : iden,
        picSrc : picsrc,
        name : nam,
        desc : description,
        tags : tgs
      });
    };

    static get properties() {
      return {
        appartments : {
          type : Array,
          value : function() {
            return [
              // {picSrc: "http://www.book-a-flat.com/photo/paris/13166/large/salon7.jpg",
              //   name : "CoolPic",
              //   desc : "Pic from internet"},
              //   {picSrc: "http://www.book-a-flat.com/photo/paris/13166/large/salon7.jpg",
              //    name : "CoolPic",
              //    desc : "Pic from internet"},
              //    {picSrc: "http://www.book-a-flat.com/photo/paris/13166/large/salon7.jpg",
              //     name : "CoolPic",
              //     desc : "Pic from internet"},
              //     {picSrc: "http://www.book-a-flat.com/photo/paris/13166/large/salon7.jpg",
              //      name : "CoolPic",
              //      desc : "Pic from internet"},
              //      {picSrc: "http://www.book-a-flat.com/photo/paris/13166/large/salon7.jpg",
              //       name : "CoolPic",
              //       desc : "Pic from internet"},
              //       {picSrc: "http://www.book-a-flat.com/photo/paris/13166/large/salon7.jpg",
              //         name : "CoolPic",
              //         desc : "Pic from internet"}
            ]
          },
          notify: true
        },
        people : {
          type : Array,
          value : function() {
            return [
                  // {picSrc: "https://www.imagejournal.org/wp-content/uploads/bb-plugin/cache/23466317216_b99485ba14_o-panorama.jpg",
                  //   name : "CoolPic",
                  //   desc : "Pic from internet"},
                  //   {picSrc: "https://www.imagejournal.org/wp-content/uploads/bb-plugin/cache/23466317216_b99485ba14_o-panorama.jpg",
                  //    name : "CoolPic",
                  //    desc : "Pic from internet"},
                  //    {picSrc: "https://www.imagejournal.org/wp-content/uploads/bb-plugin/cache/23466317216_b99485ba14_o-panorama.jpg",
                  //     name : "CoolPic",
                  //     desc : "Pic from internet"},
                  //     {picSrc: "https://www.imagejournal.org/wp-content/uploads/bb-plugin/cache/23466317216_b99485ba14_o-panorama.jpg",
                  //      name : "CoolPic",
                  //      desc : "Pic from internet"},
                  //      {picSrc: "https://www.imagejournal.org/wp-content/uploads/bb-plugin/cache/23466317216_b99485ba14_o-panorama.jpg",
                  //       name : "CoolPic",
                  //       desc : "Pic from internet"},
                  //       {picSrc: "https://www.imagejournal.org/wp-content/uploads/bb-plugin/cache/23466317216_b99485ba14_o-panorama.jpg",
                  //         name : "CoolPic",
                  //         desc : "Pic from internet"}
                    ]
          },
          notify: true
        },
        toggle : {
          type : Boolean,
          value : false,
          notify : true
        }
      }
    }

  }
  customElements.define(MainPage.is, MainPage);
  </script>
</dom-module>
